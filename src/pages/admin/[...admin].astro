---
export const prerender = false;

import { Admin } from "bknd/ui";
import "bknd/dist/styles.css";
import { getApi } from "../../bknd";

// as commented in middleware.ts, we're not using the locals here, instead getting the user from the api. So that static pages remain static
//const { user } = Astro.locals

const api = await getApi(Astro, { mode: "dynamic", verify: true });
const user = api.getUser();

if (!user && !Astro.url.pathname.startsWith("/admin/auth")) {
   return Astro.redirect("/admin/auth/login");
}

---

<html>
   <body>
      <Admin
         withProvider={{ user }}
         config={{
            basepath: "/admin",
            theme: "system",
            logo_return_path: "/../"
         }}
         client:only="react"
      />
   </body>
</html>